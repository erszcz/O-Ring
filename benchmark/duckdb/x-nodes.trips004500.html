<!DOCTYPE html>
<html>
<head>
  <title>o-ring benchmark</title>
  <script src="https://cdn.plot.ly/plotly-3.2.0.min.js" charset="utf-8"></script>
  <style type='text/css'>
    body { font-family: sans-serif; }
    div#content {
        width: 40%;
        margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id='content'>
    <h1>o-ring benchmark</h1>
    <p>
    Taken from "Programming Erlang", second edition, by Joe Armstrong:
    </p>
    <blockquote>Write a ring benchmark. Create N processes in a ring. Send a message 
    round the ring M times so that a total of N * M messages get sent. Time 
    how long this takes for different values of N and M. 
    Write a similar program in some other programming language you are 
    familiar with. Compare the results. Write a blog, and publish the results 
    on the Internet!</blockquote>
    <div id="plot"></div>
  </div>
  <script>
    async function createPlot(csv_url) {
      const response = await fetch(csv_url);
      const data = await response.text();
      const lines = data.trim().split('\n');
      const header_line = lines.shift();
      const header = header_line.split(',');

      const subtitle = header[0];
      const series_names = header.slice(1).map(name => name.replace("-runtime-median", ""));

      const x_values = [];
      const y_values = series_names.map(() => []);

      lines.forEach(line => {
        const values = line.split(',');
        x_values.push(values[0].split('-')[0]);
        for (let i = 1; i < values.length; i++) {
          y_values[i-1].push(values[i]);
        }
      });

      const traces = [];
      for (let i = 0; i < series_names.length; i++) {
        traces.push({
          name: series_names[i],
          x: x_values,
          y: y_values[i],
          mode: 'lines+markers'
        });
      }

      const ntrips_parts = subtitle.split(' ');
      const ntrips = ntrips_parts[1];

      const layout = {
        title: {text: subtitle},
        xaxis: {title: {text: "nodes, " + ntrips} },
        yaxis: {title: {text: "runtime median (ms)"} },
        width: 1400,
        height: 900
      };

      Plotly.newPlot("plot", {data: traces, layout: layout});
    }
    createPlot('plot-inputs/x-nodes.trips004500.csv');
  </script>
</body>
</html>
