<!DOCTYPE html>
<html>
<head>
  <title>o-ring benchmark</title>
  <script src="https://cdn.plot.ly/plotly-3.2.0.min.js" charset="utf-8"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style type='text/css'>
  </style>
</head>
<body class="font-sans">
  <div id='content' class="mx-auto w-3/5">
    <h1 class="mb-6 mt-6 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl sm:px-16 xl:px-48">o-ring benchmark</h1>
    <p class="mb-6 text-lg font-normal text-gray-500 lg:text-xl sm:px-16 xl:px-48">
    Taken from "Programming Erlang", second edition, by Joe Armstrong:
    </p>

    <blockquote class="text-xl italic text-gray-500 sm:px-16 xl:px-48">
    <svg class="w-8 h-8 text-gray-400 mb-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 18 14">
        <path d="M6 0H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v1a3 3 0 0 1-3 3H2a1 1 0 0 0 0 2h1a5.006 5.006 0 0 0 5-5V2a2 2 0 0 0-2-2Zm10 0h-4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v1a3 3 0 0 1-3 3h-1a1 1 0 0 0 0 2h1a5.006 5.006 0 0 0 5-5V2a2 2 0 0 0-2-2Z"/>
    </svg>
    <p>
    Write a ring benchmark. Create N processes in a ring. Send a message 
    round the ring M times so that a total of N * M messages get sent. Time 
    how long this takes for different values of N and M. 
    Write a similar program in some other programming language you are 
    familiar with. Compare the results. Write a blog, and publish the results 
    on the Internet!
    </p>
    </blockquote>
    <div id="plot" class="mx-auto w-3/5"></div>
  </div>
  <script>
    async function createPlot(csv_url) {
      const response = await fetch(csv_url);
      const data = await response.text();
      const lines = data.trim().split('\n');
      const header_line = lines.shift();
      const header = header_line.split(',');

      const subtitle = header[0];
      const series_names = header.slice(1).map(name => name.replace("-runtime-median", ""));

      const x_values = [];
      const y_values = series_names.map(() => []);

      lines.forEach(line => {
        const values = line.split(',');
        x_values.push(values[0].split('-')[0]);
        for (let i = 1; i < values.length; i++) {
          y_values[i-1].push(values[i]);
        }
      });

      const traces = [];
      for (let i = 0; i < series_names.length; i++) {
        traces.push({
          name: series_names[i],
          x: x_values,
          y: y_values[i],
          mode: 'lines+markers'
        });
      }

      const ntrips_parts = subtitle.split(' ');
      const ntrips = ntrips_parts[1];

      const layout = {
        title: {text: "o-ring benchmark median runtime"},
        xaxis: {title: {text: "nodes, " + ntrips} },
        yaxis: {title: {text: "runtime median (ms)"} },
        height: 800,
        <!--paper_bgcolor: '#7f7f7f',-->
        <!--plot_bgcolor: '#c7c7c7',-->
      };

      const config = {responsive: true}

      Plotly.newPlot("plot", {data: traces, layout: layout, config: config})
    }
    createPlot('plot-inputs/x-nodes.trips004500.csv');
  </script>
</body>
</html>
